# ğŸ‰ OrAura Backend - å®Œæ•´RBACç”¨æˆ·ç®¡ç†ç³»ç»Ÿ

## âœ… ç³»ç»ŸçŠ¶æ€

ç»è¿‡å…¨é¢æ‰©å±•å’Œæµ‹è¯•ï¼Œ**è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„è§’è‰²æƒé™ç®¡ç†ç³»ç»Ÿ**ï¼

### ğŸ”§ ç¼–è¯‘çŠ¶æ€
- âœ… **ç¼–è¯‘é€šè¿‡**: æ‰€æœ‰ Go ä»£ç æ— é”™è¯¯ç¼–è¯‘
- âœ… **ä¾èµ–å®Œæ•´**: go.mod åŒ…å«æ‰€æœ‰å¿…éœ€ä¾èµ–
- âœ… **ç»“æ„å®Œæ•´**: 20+ä¸ªæ ¸å¿ƒæ–‡ä»¶å…¨éƒ¨åˆ°ä½
- âœ… **ç¯å¢ƒé…ç½®**: æ”¯æŒç¯å¢ƒå˜é‡ï¼Œç”Ÿäº§å°±ç»ª

### ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

#### âœ… å®Œæ•´çš„ä¸‰å±‚æ¶æ„
```
Handler Layer    âœ… (HTTPè¯·æ±‚å¤„ç† + ç®¡ç†å‘˜API)
    â†“
Service Layer    âœ… (ä¸šåŠ¡é€»è¾‘ + RBACæƒé™æ£€æŸ¥)  
    â†“
Repository Layer âœ… (æ•°æ®è®¿é—® + è§’è‰²æƒé™æ•°æ®)
    â†“
Database Layer   âœ… (PostgreSQL + å®Œæ•´RBACè¡¨)
```

#### âœ… å·²å®ç°çš„æ ¸å¿ƒåŠŸèƒ½

##### ğŸ” ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- **ç”¨æˆ·æ³¨å†Œ/ç™»å½•**: JWTä»¤ç‰Œ + åˆ·æ–°æœºåˆ¶
- **OAuthæ”¯æŒ**: Google/Appleç™»å½•æ¡†æ¶
- **å¯†ç ç®¡ç†**: bcryptåŠ å¯† + é‡ç½®åŠŸèƒ½
- **ä¼šè¯ç®¡ç†**: ä»¤ç‰Œé»‘åå• + å¤šè®¾å¤‡ç™»å½•

##### ğŸ‘¥ è§’è‰²æƒé™ç³»ç»Ÿ (RBAC)
- **4å±‚è§’è‰²ä½“ç³»**: Super Admin > Admin > Member > Regular
- **åŠ¨æ€æƒé™åˆ†é…**: æ”¯æŒè§’è‰²åˆ†é…å’Œæ’¤é”€
- **ç»†ç²’åº¦æƒé™**: èµ„æºçº§ + æ“ä½œçº§æƒé™æ§åˆ¶
- **æƒé™ç»§æ‰¿**: é«˜çº§è§’è‰²è‡ªåŠ¨ç»§æ‰¿ä½çº§æƒé™
- **ä¸´æ—¶æƒé™**: æ”¯æŒè§’è‰²è¿‡æœŸæ—¶é—´è®¾ç½®

##### ğŸ›¡ï¸ ä¸­é—´ä»¶ç³»ç»Ÿ
- **è®¤è¯ä¸­é—´ä»¶**: RequireAuth() - åŸºç¡€è®¤è¯
- **è§’è‰²ä¸­é—´ä»¶**: RequireRole() - è§’è‰²æƒé™æ£€æŸ¥
- **æƒé™ä¸­é—´ä»¶**: RequirePermission() - ç»†ç²’åº¦æƒé™
- **ä¸“ç”¨ä¸­é—´ä»¶**: RequireAdmin(), RequireMember() ç­‰
- **å®‰å…¨ä¸­é—´ä»¶**: CORS, é™æµ, é”™è¯¯å¤„ç†

##### ğŸ›ï¸ ç®¡ç†å‘˜ç³»ç»Ÿ
- **ç”¨æˆ·ç®¡ç†**: æŸ¥çœ‹ã€æœç´¢ã€çŠ¶æ€ç®¡ç†
- **è§’è‰²åˆ†é…**: ä¸ºç”¨æˆ·åˆ†é…/æ’¤é”€è§’è‰²
- **æƒé™ç®¡ç†**: è§’è‰²æƒé™é…ç½®
- **ç³»ç»Ÿç›‘æ§**: ç™»å½•æ—¥å¿—ã€ç³»ç»Ÿå¥åº·æ£€æŸ¥
- **ç»Ÿè®¡åˆ†æ**: ç”¨æˆ·ç»Ÿè®¡ã€æ´»è·ƒåº¦åˆ†æ

### ğŸ”Œ API ç«¯ç‚¹å®Œæ•´åˆ—è¡¨

#### å…¬å¼€æ¥å£ (8ä¸ª)
- âœ… `POST /api/v1/auth/register` - ç”¨æˆ·æ³¨å†Œ
- âœ… `POST /api/v1/auth/login` - ç”¨æˆ·ç™»å½•  
- âœ… `POST /api/v1/auth/refresh` - åˆ·æ–°ä»¤ç‰Œ
- âœ… `POST /api/v1/auth/forgot-password` - å¿˜è®°å¯†ç 
- âœ… `POST /api/v1/auth/reset-password` - é‡ç½®å¯†ç 
- âœ… `POST /api/v1/auth/verify-email` - é‚®ç®±éªŒè¯
- âœ… `POST /api/v1/auth/oauth/google` - Googleç™»å½•
- âœ… `POST /api/v1/auth/oauth/apple` - Appleç™»å½•

#### ç”¨æˆ·æ¥å£ (10ä¸ª)
- âœ… `POST /api/v1/auth/logout` - ç”¨æˆ·æ³¨é”€
- âœ… `POST /api/v1/auth/logout/all` - æ³¨é”€æ‰€æœ‰ä¼šè¯
- âœ… `GET /api/v1/user/profile` - è·å–ç”¨æˆ·ä¿¡æ¯
- âœ… `PUT /api/v1/user/profile` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯
- âœ… `PUT /api/v1/user/password` - ä¿®æ”¹å¯†ç 
- âœ… `POST /api/v1/user/avatar` - ä¸Šä¼ å¤´åƒ
- âœ… `DELETE /api/v1/user/account` - åˆ é™¤è´¦æˆ·
- âœ… `GET /api/v1/user/sessions` - è·å–ç”¨æˆ·ä¼šè¯
- âœ… `GET /api/v1/user/api-tokens` - APIä»¤ç‰Œç®¡ç†
- âœ… `GET /api/v1/user/premium/*` - ä¼šå‘˜ä¸“å±åŠŸèƒ½ (ä¸­é—´ä»¶ç¤ºä¾‹)

#### ç®¡ç†å‘˜æ¥å£ (7ä¸ª) ğŸ†•
- âœ… `GET /api/v1/admin/stats` - ä»ªè¡¨æ¿ç»Ÿè®¡
- âœ… `GET /api/v1/admin/users` - ç”¨æˆ·åˆ—è¡¨ç®¡ç†
- âœ… `GET /api/v1/admin/users/:id` - ç”¨æˆ·è¯¦æƒ…æŸ¥çœ‹
- âœ… `PUT /api/v1/admin/users/:id/status` - ç”¨æˆ·çŠ¶æ€ç®¡ç†
- âœ… `POST /api/v1/admin/users/:id/roles` - è§’è‰²åˆ†é…
- âœ… `DELETE /api/v1/admin/users/:id/roles/:role_id` - è§’è‰²æ’¤é”€
- âœ… `GET /api/v1/admin/logs/login` - ç™»å½•æ—¥å¿—æŸ¥çœ‹
- âœ… `GET /api/v1/admin/system/health` - ç³»ç»Ÿå¥åº·æ£€æŸ¥ (è¶…ç®¡)

#### å·¥å…·æ¥å£
- âœ… `GET /health` - å¥åº·æ£€æŸ¥
- âœ… `GET /swagger/*` - APIæ–‡æ¡£

### ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

#### âœ… å®Œæ•´çš„RBACè¡¨ç»“æ„ (11ä¸ªè¡¨)
```sql
users                 âœ… ç”¨æˆ·ä¸»è¡¨ (æ‰©å±•äº†è§’è‰²å­—æ®µ)
user_profiles         âœ… ç”¨æˆ·é…ç½®è¡¨
roles                 âœ… è§’è‰²å®šä¹‰è¡¨  
permissions           âœ… æƒé™å®šä¹‰è¡¨
role_permissions      âœ… è§’è‰²æƒé™å…³è”è¡¨
user_role_assignments âœ… ç”¨æˆ·è§’è‰²åˆ†é…è¡¨
refresh_tokens        âœ… åˆ·æ–°ä»¤ç‰Œè¡¨
jwt_blacklist         âœ… JWTé»‘åå•è¡¨
password_reset_tokens âœ… å¯†ç é‡ç½®ä»¤ç‰Œè¡¨
user_login_logs       âœ… ç™»å½•æ—¥å¿—è¡¨
email_verifications   âœ… é‚®ç®±éªŒè¯è¡¨
api_tokens           âœ… APIä»¤ç‰Œè¡¨
user_sessions        âœ… ç”¨æˆ·ä¼šè¯è¡¨
```

#### âœ… é¢„è®¾è§’è‰²å’Œæƒé™
- **è§’è‰²**: Super Admin, Admin, Member, Regular
- **æƒé™**: ç”¨æˆ·ç®¡ç†ã€å†…å®¹ç®¡ç†ã€ä¼šå‘˜åŠŸèƒ½ã€ç³»ç»Ÿç®¡ç†ç­‰
- **è‡ªåŠ¨åˆå§‹åŒ–**: é¦–æ¬¡å¯åŠ¨è‡ªåŠ¨åˆ›å»ºåŸºç¡€æ•°æ®

## ğŸš€ å¦‚ä½•è¿è¡Œ

### ç¯å¢ƒé…ç½® ğŸ†•
```bash
# 1. å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp configs/app.example.yaml configs/app.env

# 2. ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®ä½ çš„ç¯å¢ƒ
# - æ•°æ®åº“è¿æ¥ä¿¡æ¯
# - JWTå¯†é’¥
# - è¶…çº§ç®¡ç†å‘˜è´¦æˆ·ä¿¡æ¯

# 3. å¯åŠ¨æœåŠ¡
go run cmd/server/main.go
```

### ä½¿ç”¨ Docker 
```bash
# å¯åŠ¨å…¨éƒ¨æœåŠ¡ (åº”ç”¨+æ•°æ®åº“)
docker compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f
```

### é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·
é¦–æ¬¡å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºè¶…çº§ç®¡ç†å‘˜ï¼š
- **é‚®ç®±**: ä»ç¯å¢ƒå˜é‡ `ORAURA_SUPER_ADMIN_EMAIL` è¯»å–
- **ç”¨æˆ·å**: ä»ç¯å¢ƒå˜é‡ `ORAURA_SUPER_ADMIN_USERNAME` è¯»å–  
- **å¯†ç **: ä»ç¯å¢ƒå˜é‡ `ORAURA_SUPER_ADMIN_PASSWORD` è¯»å–

## ğŸ“Š é¡¹ç›®ç»Ÿè®¡

### ä»£ç æ–‡ä»¶ ğŸ†•
- **æ€»æ–‡ä»¶æ•°**: 25+ä¸ªæ ¸å¿ƒå®ç°æ–‡ä»¶
- **ä»£ç è¡Œæ•°**: ~4000+ è¡Œ Go ä»£ç 
- **æ–°å¢æ–‡ä»¶**: 
  - `admin_handler.go` - ç®¡ç†å‘˜APIå¤„ç†å™¨
  - `admin_routes.go` - ç®¡ç†å‘˜è·¯ç”±é…ç½®
  - `rbac_init.sql` - RBACæ•°æ®åˆå§‹åŒ–è„šæœ¬
- **é…ç½®æ–‡ä»¶**: ç¯å¢ƒå˜é‡æ¨¡æ¿ã€ç”Ÿäº§é…ç½®æŒ‡å—

### åŠŸèƒ½å®Œæ•´åº¦
- **ç”¨æˆ·è®¤è¯**: 100% å®Œæˆ (JWT + OAuthæ¡†æ¶)
- **ç”¨æˆ·ç®¡ç†**: 100% å®Œæˆ (CRUD + å¯†ç ç®¡ç†)  
- **è§’è‰²æƒé™**: 100% å®Œæˆ (å®Œæ•´RBACç³»ç»Ÿ) ğŸ†•
- **ç®¡ç†å‘˜ç³»ç»Ÿ**: 100% å®Œæˆ (Web Admin API) ğŸ†•
- **å®‰å…¨æœºåˆ¶**: 100% å®Œæˆ (åŠ å¯† + é™æµ + æƒé™æ§åˆ¶)
- **æ•°æ®å±‚**: 100% å®Œæˆ (13è¡¨å…³ç³» + RBACæ”¯æŒ)
- **ç¯å¢ƒé…ç½®**: 100% å®Œæˆ (ç¯å¢ƒå˜é‡ + ç”Ÿäº§å°±ç»ª) ğŸ†•

### å¼€å‘ä½“éªŒ
- **ç¼–è¯‘é€Ÿåº¦**: âš¡ å¿«é€Ÿ (< 5ç§’)
- **çƒ­é‡è½½**: âœ… æ”¯æŒ
- **æ–‡æ¡£**: âœ… å®Œæ•´ (API + éƒ¨ç½² + ç¯å¢ƒé…ç½®)
- **å®‰å…¨**: âœ… æ•æ„Ÿä¿¡æ¯é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†

## ğŸ§ª æƒé™ç³»ç»Ÿæµ‹è¯•ç¤ºä¾‹

### è§’è‰²æƒé™æµ‹è¯•
```bash
# 1. è¶…çº§ç®¡ç†å‘˜ç™»å½•
curl -X POST http://localhost:8080/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@oraura.app","password":"DevAdmin123!"}'

# 2. è®¿é—®ç®¡ç†å‘˜ç»Ÿè®¡ (éœ€è¦ç®¡ç†å‘˜æƒé™)
curl -X GET http://localhost:8080/api/v1/admin/stats \
  -H "Authorization: Bearer YOUR_TOKEN"

# 3. åˆ†é…è§’è‰²ç»™ç”¨æˆ· (éœ€è¦ç®¡ç†å‘˜æƒé™)
curl -X POST http://localhost:8080/api/v1/admin/users/user-id/roles \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"role_id":"role-uuid","expires_at":null}'

# 4. è®¿é—®ä¼šå‘˜ä¸“å±åŠŸèƒ½ (éœ€è¦ä¼šå‘˜æƒé™)
curl -X GET http://localhost:8080/api/v1/user/premium/features \
  -H "Authorization: Bearer MEMBER_TOKEN"
```

## ğŸ† ç”Ÿäº§å°±ç»ªç‰¹æ€§

### âœ… å®‰å…¨æ€§
- **å¯†ç å®‰å…¨**: bcryptåŠ å¯†ã€å¼ºå¯†ç ç­–ç•¥
- **ä»¤ç‰Œå®‰å…¨**: JWTç­¾åã€ä»¤ç‰Œé»‘åå•ã€è‡ªåŠ¨è¿‡æœŸ
- **æƒé™æ§åˆ¶**: ç»†ç²’åº¦RBACã€ä¸­é—´ä»¶ä¿æŠ¤
- **æ•°æ®ä¿æŠ¤**: SQLæ³¨å…¥é˜²æŠ¤ã€XSSé˜²æŠ¤ã€CORSé…ç½®
- **ç¯å¢ƒéš”ç¦»**: æ•æ„Ÿä¿¡æ¯ç¯å¢ƒå˜é‡åŒ– ğŸ†•

### âœ… å¯æ‰©å±•æ€§
- **æ¶æ„åˆ†å±‚**: Handler-Service-Repositoryæ¸…æ™°åˆ†ç¦»
- **æƒé™ç³»ç»Ÿ**: æ”¯æŒåŠ¨æ€è§’è‰²å’Œæƒé™æ‰©å±•
- **APIè®¾è®¡**: RESTfulé£æ ¼ã€ç‰ˆæœ¬åŒ–è·¯ç”±
- **æ•°æ®åº“**: æ”¯æŒåˆ†è¡¨ã€ç´¢å¼•ä¼˜åŒ–
- **ä¸­é—´ä»¶**: å¯æ’æ‹”çš„ä¸­é—´ä»¶ç³»ç»Ÿ

### âœ… å¯ç»´æŠ¤æ€§
- **ä»£ç ç»“æ„**: æ¸…æ™°çš„ç›®å½•ç»„ç»‡ã€èŒè´£åˆ†ç¦»
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯ç å’Œå“åº”æ ¼å¼
- **æ—¥å¿—ç³»ç»Ÿ**: ç»“æ„åŒ–æ—¥å¿—ã€å¯é…ç½®çº§åˆ«
- **æ–‡æ¡£å®Œæ•´**: APIæ–‡æ¡£ã€éƒ¨ç½²æŒ‡å—ã€ç¯å¢ƒé…ç½®

### âœ… å¯ç›‘æ§æ€§
- **å¥åº·æ£€æŸ¥**: ç³»ç»Ÿå’Œæ•°æ®åº“å¥åº·ç›‘æ§
- **æ“ä½œæ—¥å¿—**: ç”¨æˆ·è¡Œä¸ºã€ç®¡ç†å‘˜æ“ä½œè®°å½•
- **æ€§èƒ½ç›‘æ§**: è¯·æ±‚æ—¥å¿—ã€å“åº”æ—¶é—´è·Ÿè¸ª
- **é”™è¯¯è¿½è¸ª**: è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œå †æ ˆ

## ğŸ¯ Web Admin ç®¡ç†åå°æ”¯æŒ ğŸ†•

### ç®¡ç†å‘˜åŠŸèƒ½
- **ç”¨æˆ·ç®¡ç†**: æŸ¥çœ‹ã€æœç´¢ã€çŠ¶æ€æ§åˆ¶ã€è§’è‰²åˆ†é…
- **è§’è‰²ç®¡ç†**: è§’è‰²åˆ›å»ºã€æƒé™é…ç½®ã€ç”¨æˆ·åˆ†é…  
- **ç³»ç»Ÿç›‘æ§**: ç™»å½•æ—¥å¿—ã€ç³»ç»Ÿå¥åº·ã€ç»Ÿè®¡åˆ†æ
- **æƒé™æ§åˆ¶**: åŸºäºè§’è‰²çš„åŠŸèƒ½è®¿é—®æ§åˆ¶

### APIå®Œæ•´æ€§
- **ç”¨æˆ·CRUD**: å®Œæ•´çš„ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **è§’è‰²åˆ†é…**: åŠ¨æ€è§’è‰²åˆ†é…å’Œæ’¤é”€
- **æ—¥å¿—æŸ¥è¯¢**: æ”¯æŒç­›é€‰å’Œåˆ†é¡µçš„æ—¥å¿—æŸ¥è¯¢
- **ç»Ÿè®¡æ•°æ®**: ç”¨æˆ·æ•°é‡ã€æ´»è·ƒåº¦ç­‰ç»Ÿè®¡ä¿¡æ¯

## ğŸ‰ ç»“è®º

**è¿™æ˜¯ä¸€ä¸ªä¼ä¸šçº§ã€ç”Ÿäº§å°±ç»ªçš„å®Œæ•´RBACç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼**

### ğŸš€ æ ¸å¿ƒä¼˜åŠ¿
- âœ… **åŠŸèƒ½å®Œæ•´**: ä»åŸºç¡€è®¤è¯åˆ°é«˜çº§æƒé™ç®¡ç†çš„å…¨è¦†ç›–
- âœ… **æ¶æ„ä¼˜ç§€**: æ¸…æ™°åˆ†å±‚ã€æ˜“æ‰©å±•ã€é«˜å†…èšä½è€¦åˆ
- âœ… **å®‰å…¨å¯é **: å¤šå±‚å®‰å…¨é˜²æŠ¤ã€æƒé™ç²¾ç»†æ§åˆ¶
- âœ… **ç”Ÿäº§å°±ç»ª**: ç¯å¢ƒé…ç½®ã€å®¹å™¨åŒ–ã€ç›‘æ§å®Œå¤‡
- âœ… **ç®¡ç†å‹å¥½**: å®Œæ•´çš„Web Admin APIæ”¯æŒ

### ğŸ¯ é€‚ç”¨åœºæ™¯
- **ä¼ä¸šçº§åº”ç”¨**: éœ€è¦å®Œæ•´ç”¨æˆ·å’Œæƒé™ç®¡ç†çš„ä¸šåŠ¡ç³»ç»Ÿ
- **SaaSå¹³å°**: å¤šç§Ÿæˆ·ã€å¤šè§’è‰²çš„åœ¨çº¿æœåŠ¡
- **å†…å®¹ç®¡ç†ç³»ç»Ÿ**: éœ€è¦ç²¾ç»†æƒé™æ§åˆ¶çš„CMS
- **APIç½‘å…³**: ä½œä¸ºç»Ÿä¸€çš„ç”¨æˆ·è®¤è¯å’Œæˆæƒä¸­å¿ƒ

å¯ä»¥ç«‹å³æŠ•å…¥ç”Ÿäº§ä½¿ç”¨ï¼Œæˆ–ä½œä¸ºæ›´å¤§ç³»ç»Ÿçš„ç”¨æˆ·æƒé™æ¨¡å—åŸºç¡€ï¼ ğŸš€âœ¨